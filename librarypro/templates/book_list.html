{%load static%}
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>Book List</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
     <style>
        body {
            background-color: black;
            color: white;
        }
         .card {
            height: 600px;
            background-color: black;
            border: 2px solid red;
            color: white; /* Change text color to white for better visibility */
        }
         .custom-text-color {
              color: red;
         }

    </style>
</head>
<body >
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
    <a class="navbar-brand" href="/profile">PROFILE</a>
    <a class="navbar-brand" href="/books">BOOKS</a>
    <a class="navbar-brand" href="/">HOME</a>

    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="/about">About Us</a>
        </li>
    </ul>

<ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul>
<a class="navbar-brand" color="custom-text-color">BOUNDLESS BOOKS</a>
    <ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul>
    <ul></ul><ul></ul>
    <div class="nav-searchbar">
        <i class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-search" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
        </i>
        <input type="search" name="search" id="search" placeholder="Search Books">
    </div>
</nav>
<div class="container mt-5">
    <h1>All kinds of books</h1>
    <div class="mb-4">
        <a href="/add_book" class="btn btn-primary">Add Book</a>
    </div>

    <div class="row" id="bookList">
        <!-- Books will be displayed here -->
    </div>
    <div class="row">
            {% for book in books %}
                <div class="col-md-3"> <!-- Decreased from col-md-4 to col-md-3 -->
                    <div class="card mb-3 shadow-sm"> <!-- Decreased from mb-4 to mb-3 -->
                        <div class="card-body">
                            <h6 class="card-title" style="font-size: 1rem;">{{ book.title }}</h6> <!-- Reduced font size -->
                            <p class="card-text" style="font-size: 0.9rem;">by {{ book.author }}</p> <!-- Reduced font size -->
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
$(document).ready(function(){

    // Function to fetch books
    function fetchBooks(searchTerm = ''){
        const apiEndpoint = `http://openlibrary.org/search.json?q=${searchTerm}`;
        $.ajax({
            url: apiEndpoint,
            type: "GET",
            dataType: "json",
            success: function(data){
                const apiBooks = data.docs.map(book => ({
                    title: book.title,
                    author: book.author_name ? book.author_name[0] : 'Unknown',
                    cover: book.cover_i ? `http://covers.openlibrary.org/b/id/${book.cover_i}-M.jpg` : ''
                }));
                const famousBooks = [
                    { title: 'To Kill a Mockingbird', author: 'Harper Lee', cover: '{% static "images/tokillamockingbird.jpg" %}',pdfUrl: 'https://drive.google.com/file/d/1hJ4I10ouqklLVqc8zeke8SDlxhZr5s48/view?usp=drive_link' },
                    { title: 'The Great Gatsby', author: 'F. Scott Fitzgerald', cover: '{% static "images/greatgatsby.jpg" %}',pdfUrl: 'https://drive.google.com/file/d/1QMfl5_txK88WO_3_G_ycny6N8AQhhRUp/view?usp=sharing' },
                    { title: '1984', author: 'George Orwell', cover: '{% static "images/1984.jpg" %}',pdfUrl: 'https://drive.google.com/file/d/1fRPM3H96vPGHyX127x9WPfAzrNU5iViX/view?usp=drive_link' },
                    { title: 'Pride and Prejudice', author: 'Jane Austen', cover: '{% static "images/prideprejudice.jpeg" %}',pdfUrl: 'https://drive.google.com/file/d/1XPDvL2Tr-cNIq3FqgxVcufoQRFVgQlmK/view?usp=drive_link' },
                    { title: 'The Catcher in the Rye', author: 'J.D. Salinger', cover: '{% static "images/catcherintherye.jpg" %}',pdfUrl: 'https://drive.google.com/file/d/1Fhs_nebFH1atosEJu6wi7PwHEKzjA596/view?usp=drive_link' },
                ];

                const allBooks = [...apiBooks, ...famousBooks]; // Combine both book lists

                displayBooks(allBooks);
            },
            error: function(error){
                console.error("Failed to fetch books:", error);
            }
        });
    }

    // Function to display books
    function displayBooks(booksArray){
        let html = '';
        booksArray.forEach(book => {
            html += `
                <div class="col-md-3">
                    <div class="card mb-4 shadow-sm" data-pdf-url="${book.pdfUrl}">
                        <img src="${book.cover}" class="card-img-top" alt="${book.title}">
                        <div class="card-body">
                            <h5 class="card-title pdf-link">${book.title}</h5> <!-- Add pdf-link class to the title -->
                            <p class="card-text">by ${book.author}</p>
                        </div>
                    </div>
                </div>
            `;
        });
        $('#bookList').html(html);

        // Add click event listener to each card
        $('.card').click(function() {
            const url = $(this).data('pdf-url');
            if (url) {
                window.open(url, '_blank'); // Open PDF URL in a new tab/window
            }
        });

        // Add click event listener to pdf-link class
        $('.pdf-link').click(function() {
            const url = $(this).closest('.card').data('pdf-url');
            if (url) {
                window.open(url, '_blank');
            }
        });
    }

    // Initial display of all books
    fetchBooks();

    // Search functionality
    $('#search').keypress(function(event){
        if(event.which === 13){
            const searchTerm = $('#search').val();
            fetchBooks(searchTerm);
        }
    });
});
</script>
</body>
</html>
